<%- include('../layouts/admin_layouts_header', { title: 'Admin | Settings', currentPage: 'settings' }) %>
<%- include('../layouts/admin_layouts_sidebar', { currentPage: 'settings' }) %>

<div class="container-fluid px-4 py-4">
    <!-- Premium Header -->
    <div class="premium-header mb-5">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h3 fw-bold text-gradient mb-2">Site Settings</h1>
                <p class="text-muted mb-0">Manage your website settings and administrator credentials</p>
            </div>
            <div class="premium-icon">
                <i class="fas fa-cogs"></i>
            </div>
        </div>
    </div>

    <!-- Success/Error Messages -->
    <% if (successMessage) { %>
        <div class="alert-premium-success alert-dismissible fade show mb-4" role="alert">
            <div class="d-flex align-items-center">
                <i class="fas fa-check-circle me-3"></i>
                <div class="fw-medium"><%= successMessage %></div>
                <button type="button" class="btn-close ms-auto" data-bs-dismiss="alert"></button>
            </div>
        </div>
    <% } %>

    <% if (errorMessage) { %>
        <div class="alert-premium-error alert-dismissible fade show mb-4" role="alert">
            <div class="d-flex align-items-center">
                <i class="fas fa-exclamation-circle me-3"></i>
                <div class="fw-medium"><%= errorMessage %></div>
                <button type="button" class="btn-close ms-auto" data-bs-dismiss="alert"></button>
            </div>
        </div>
    <% } %>

    <!-- Site Settings Section -->
    <div class="premium-card mb-5">
        <div class="premium-card-header">
            <div class="d-flex align-items-center">
                <div class="premium-icon-small me-3">
                    <i class="fas fa-globe"></i>
                </div>
                <div>
                    <h4 class="mb-1 fw-bold">Site Settings</h4>
                    <p class="mb-0 text-muted">Update your website information and branding</p>
                </div>
            </div>
        </div>
        <div class="premium-card-body">
            <form action="/admin/settings/update" method="POST" enctype="multipart/form-data" id="siteSettingsForm">
                <div class="row g-4">
                    <!-- Basic Information -->
                    <div class="col-12">
                        <h5 class="fw-bold mb-3 text-primary"><i class="fas fa-info-circle me-2"></i>Basic Information</h5>
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label fw-semibold">Site Name *</label>
                        <input type="text" class="form-control premium-input" name="site_name" 
                               value="<%= settings.site_name || '' %>" placeholder="Your Company Name" required>
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label fw-semibold">Email</label>
                        <input type="email" class="form-control premium-input" name="email" 
                               value="<%= settings.email || '' %>" placeholder="contact@company.com">
                    </div>
                    
                    <div class="col-12">
                        <label class="form-label fw-semibold">Description</label>
                        <textarea class="form-control premium-input" name="description" rows="3" 
                                  placeholder="Brief description of your website..."><%= settings.description || '' %></textarea>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-semibold">Phone</label>
                        <input type="text" class="form-control premium-input" name="phone" 
                               value="<%= settings.phone || '' %>" placeholder="+1 234 567 8900">
                    </div>

                    <div class="col-12">
                        <label class="form-label fw-semibold">Address</label>
                        <textarea class="form-control premium-input" name="address" rows="2" 
                                  placeholder="Your company address..."><%= settings.address || '' %></textarea>
                    </div>

                    <!-- Brand Assets -->
                    <div class="col-12 mt-4">
                        <h5 class="fw-bold mb-3 text-primary"><i class="fas fa-palette me-2"></i>Brand Assets</h5>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-semibold">Main Logo</label>
                        <input type="file" class="form-control premium-input" name="logo1" 
                               accept="image/*" onchange="previewImage(this, 'logo1Preview')">
                        <div class="image-preview mt-3" id="logo1Preview">
                            <% if (settings.logo1_url) { %>
                                <img src="<%= settings.logo1_url %>" alt="Current Logo 1" class="preview-thumbnail">
                                <small class="text-muted d-block mt-2">Current Logo</small>
                            <% } else { %>
                                <div class="text-center text-muted py-3">
                                    <i class="fas fa-image fa-2x mb-2"></i>
                                    <p class="mb-0 small">No logo uploaded</p>
                                </div>
                            <% } %>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-semibold">Secondary Logo</label>
                        <input type="file" class="form-control premium-input" name="logo2" 
                               accept="image/*" onchange="previewImage(this, 'logo2Preview')">
                        <div class="image-preview mt-3" id="logo2Preview">
                            <% if (settings.logo2_url) { %>
                                <img src="<%= settings.logo2_url %>" alt="Current Logo 2" class="preview-thumbnail">
                                <small class="text-muted d-block mt-2">Current Logo</small>
                            <% } else { %>
                                <div class="text-center text-muted py-3">
                                    <i class="fas fa-image fa-2x mb-2"></i>
                                    <p class="mb-0 small">No logo uploaded</p>
                                </div>
                            <% } %>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-semibold">Favicon</label>
                        <input type="file" class="form-control premium-input" name="favicon" 
                               accept="image/*" onchange="previewImage(this, 'faviconPreview')">
                        <div class="image-preview mt-3" id="faviconPreview">
                            <% if (settings.favicon_url) { %>
                                <img src="<%= settings.favicon_url %>" alt="Current Favicon" class="preview-thumbnail">
                                <small class="text-muted d-block mt-2">Current Favicon</small>
                            <% } else { %>
                                <div class="text-center text-muted py-3">
                                    <i class="fas fa-image fa-2x mb-2"></i>
                                    <p class="mb-0 small">No favicon uploaded</p>
                                </div>
                            <% } %>
                        </div>
                    </div>

                    <!-- Social Media Links -->
                    <div class="col-12 mt-4">
                        <h5 class="fw-bold mb-3 text-primary"><i class="fas fa-share-alt me-2"></i>Social Media Links</h5>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-semibold">Facebook URL</label>
                        <input type="url" class="form-control premium-input" name="facebook_url" 
                               value="<%= settings.facebook_url || '' %>" placeholder="https://facebook.com/yourpage">
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-semibold">WhatsApp URL</label>
                        <input type="url" class="form-control premium-input" name="whatsapp_url" 
                               value="<%= settings.whatsapp_url || '' %>" placeholder="https://wa.me/yournumber">
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-semibold">Instagram URL</label>
                        <input type="url" class="form-control premium-input" name="instagram_url" 
                               value="<%= settings.instagram_url || '' %>" placeholder="https://instagram.com/yourprofile">
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-semibold">Twitter URL</label>
                        <input type="url" class="form-control premium-input" name="twitter_url" 
                               value="<%= settings.twitter_url || '' %>" placeholder="https://twitter.com/yourprofile">
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-semibold">LinkedIn URL</label>
                        <input type="url" class="form-control premium-input" name="linkedin_url" 
                               value="<%= settings.linkedin_url || '' %>" placeholder="https://linkedin.com/company/yourcompany">
                    </div>

                    <!-- Submit Button -->
                    <div class="col-12 mt-4">
                        <button type="submit" class="btn-premium">
                            <i class="fas fa-save me-2"></i>Update Site Settings
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Change Credentials Section -->
    <div class="premium-card">
        <div class="premium-card-header">
            <div class="d-flex align-items-center">
                <div class="premium-icon-small me-3">
                    <i class="fas fa-user-shield"></i>
                </div>
                <div>
                    <h4 class="mb-1 fw-bold">Change Admin Credentials</h4>
                    <p class="mb-0 text-muted">Update your username and password</p>
                </div>
            </div>
        </div>
        <div class="premium-card-body">
            <form action="/admin/settings/change-credentials" method="POST" id="credentialsForm">
                <div class="row g-4">
                    <!-- Current Admin Info -->
                    <div class="col-12">
                        <div class="current-admin-info bg-light p-4 rounded mb-4">
                            <h6 class="fw-bold mb-3"><i class="fas fa-user me-2"></i>Current Admin Information</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <p class="mb-1"><strong>Username:</strong> <span class="text-primary"><%= adminInfo.username || 'Not set' %></span></p>
                                </div>
                                <div class="col-md-6">
                                    <p class="mb-1"><strong>Account Created:</strong> <span class="text-muted"><%= adminInfo.created_at ? new Date(adminInfo.created_at).toLocaleDateString() : 'Unknown' %></span></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Current Credentials -->
                    <div class="col-12">
                        <h6 class="fw-bold mb-3 text-primary">Verify Current Credentials</h6>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-semibold">Current Username *</label>
                        <input type="text" class="form-control premium-input" name="current_username" 
                               placeholder="Enter current username" required>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-semibold">Current Password *</label>
                        <input type="password" class="form-control premium-input" name="current_password" 
                               placeholder="Enter current password" required>
                    </div>

                    <!-- New Credentials -->
                    <div class="col-12 mt-3">
                        <h6 class="fw-bold mb-3 text-primary">New Credentials</h6>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-semibold">New Username</label>
                        <input type="text" class="form-control premium-input" name="new_username" 
                               placeholder="Leave blank to keep current username">
                        <small class="text-muted">If you want to keep current username, leave this field blank</small>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-semibold">New Password *</label>
                        <input type="password" class="form-control premium-input" name="new_password" 
                               id="newPassword" placeholder="Enter new password" required>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-semibold">Confirm New Password *</label>
                        <input type="password" class="form-control premium-input" name="confirm_password" 
                               placeholder="Confirm new password" required>
                    </div>

                    <div class="col-md-6">
                        <div class="password-strength mt-4">
                            <label class="form-label fw-semibold">Password Strength</label>
                            <div class="progress mb-2" style="height: 8px;">
                                <div class="progress-bar" id="passwordStrengthBar" style="width: 0%"></div>
                            </div>
                            <small class="text-muted" id="passwordStrengthText">Enter a password to check strength</small>
                        </div>
                    </div>

                    <!-- Password Requirements -->
                    <div class="col-12">
                        <div class="password-requirements bg-light p-3 rounded">
                            <h6 class="fw-bold mb-2">Password Requirements:</h6>
                            <ul class="list-unstyled mb-0 small">
                                <li><i class="fas fa-check text-success me-2"></i>Minimum 8 characters</li>
                                <li><i class="fas fa-check text-success me-2"></i>At least one uppercase letter</li>
                                <li><i class="fas fa-check text-success me-2"></i>At least one lowercase letter</li>
                                <li><i class="fas fa-check text-success me-2"></i>At least one number</li>
                                <li><i class="fas fa-check text-success me-2"></i>At least one special character</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="col-12 mt-4">
                        <button type="submit" class="btn-premium" id="credentialsBtn">
                            <i class="fas fa-key me-2"></i>Update Credentials
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- datase download -->
<div class="col-12 mt-4">
    <a href="/admin/settings/download-db" class="btn-premium">
        <i class="fas fa-download me-2"></i>Download Database
    </a>
</div>


<!-- Add Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
    /* Premium Styles */
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --success-gradient: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        --danger-gradient: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        --premium-bg: #f8fafc;
        --premium-border: #e2e8f0;
        --premium-shadow: 0 20px 40px rgba(0,0,0,0.1);
    }

    .premium-header { background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .premium-icon { width: 60px; height: 60px; background: var(--primary-gradient); border-radius: 15px; display: flex; align-items: center; justify-content: center; color: white; box-shadow: var(--premium-shadow); }
    .premium-card { background: white; border-radius: 20px; box-shadow: var(--premium-shadow); border: 1px solid var(--premium-border); overflow: hidden; margin-bottom: 2rem; }
    .premium-card-header { background: var(--premium-bg); padding: 2rem; border-bottom: 1px solid var(--premium-border); }
    .premium-card-body { padding: 2rem; }
    .premium-icon-small { width: 50px; height: 50px; background: var(--primary-gradient); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; }
    .premium-input { border: 2px solid #e2e8f0; border-radius: 10px; padding: 0.75rem 1rem; transition: all 0.3s ease; }
    .premium-input:focus { border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }

    /* Image Preview */
    .image-preview { text-align: center; }
    .preview-thumbnail { max-width: 100%; max-height: 120px; border-radius: 8px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }

    /* Buttons */
    .btn-premium { background: var(--primary-gradient); color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 10px; font-weight: 600; transition: all 0.3s ease; }
    .btn-premium:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3); }
    .btn-premium:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

    /* Alerts */
    .alert-premium-success { background: var(--success-gradient); color: white; border: none; border-radius: 15px; padding: 1rem 1.5rem; }
    .alert-premium-error { background: var(--danger-gradient); color: white; border: none; border-radius: 15px; padding: 1rem 1.5rem; }

    /* Current Admin Info */
    .current-admin-info { border-left: 4px solid #667eea; }

    /* Password Strength */
    .progress-bar { transition: width 0.3s ease; }
    .password-requirements li { margin-bottom: 0.25rem; }

    /* Section Headers */
    h5.text-primary, h6.text-primary { border-bottom: 2px solid #667eea; padding-bottom: 0.5rem; }

    /* Responsive */
    @media (max-width: 768px) {
        .premium-card-body { padding: 1.5rem; }
        .image-preview { margin-top: 1rem; }
    }
</style>

<script>
// Image preview function
function previewImage(input, previewId) {
    const preview = document.getElementById(previewId);
    
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.innerHTML = `<img src="${e.target.result}" alt="Preview" class="preview-thumbnail">
                               <small class="text-muted d-block mt-2">New Image Preview</small>`;
        }
        reader.readAsDataURL(input.files[0]);
    }
}

// Password strength checker
function checkPasswordStrength(password) {
    let strength = 0;
    const requirements = {
        length: password.length >= 8,
        uppercase: /[A-Z]/.test(password),
        lowercase: /[a-z]/.test(password),
        numbers: /[0-9]/.test(password),
        special: /[^A-Za-z0-9]/.test(password)
    };

    Object.values(requirements).forEach(req => {
        if (req) strength += 20;
    });

    return {
        strength: strength,
        requirements: requirements
    };
}

// Update password strength indicator
document.getElementById('newPassword').addEventListener('input', function() {
    const password = this.value;
    const result = checkPasswordStrength(password);
    const bar = document.getElementById('passwordStrengthBar');
    const text = document.getElementById('passwordStrengthText');
    
    bar.style.width = result.strength + '%';
    
    if (password.length === 0) {
        bar.className = 'progress-bar';
        text.textContent = 'Enter a password to check strength';
        text.className = 'text-muted';
    } else if (result.strength < 40) {
        bar.className = 'progress-bar bg-danger';
        text.textContent = 'Weak password';
        text.className = 'text-danger';
    } else if (result.strength < 80) {
        bar.className = 'progress-bar bg-warning';
        text.textContent = 'Medium strength';
        text.className = 'text-warning';
    } else {
        bar.className = 'progress-bar bg-success';
        text.textContent = 'Strong password';
        text.className = 'text-success';
    }
});

// Form validation and submission
document.addEventListener('DOMContentLoaded', function() {
    // Auto-hide alerts
    const alerts = document.querySelectorAll('.alert-premium-success, .alert-premium-error');
    alerts.forEach(alert => {
        setTimeout(() => {
            if (alert.parentNode) {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            }
        }, 5000);
    });

    // Site settings form submission
    const siteSettingsForm = document.getElementById('siteSettingsForm');
    if (siteSettingsForm) {
        siteSettingsForm.addEventListener('submit', function() {
            const submitBtn = this.querySelector('button[type="submit"]');
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Updating...';
            submitBtn.disabled = true;
        });
    }

    // Credentials form validation
    const credentialsForm = document.getElementById('credentialsForm');
    if (credentialsForm) {
        credentialsForm.addEventListener('submit', function(e) {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = this.querySelector('input[name="confirm_password"]').value;
            const submitBtn = document.getElementById('credentialsBtn');
            
            if (newPassword !== confirmPassword) {
                e.preventDefault();
                alert('New passwords do not match!');
                return;
            }

            if (newPassword.length > 0 && newPassword.length < 8) {
                e.preventDefault();
                alert('Password must be at least 8 characters long!');
                return;
            }

            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Updating...';
            submitBtn.disabled = true;
        });
        
    }
});
</script>

<%- include('../layouts/admin_layouts_footer') %>